<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <title>职位列表</title>
  <!-- 样式 & 脚本 -->
  <link th:href="@{/css/manageadmin.css}" rel="stylesheet" />
  <script th:src="@{/js/jquery.js}"></script>

  <style>
    .tablelink { color: #4285f4; text-decoration: none; cursor: pointer; }
    .tablelink:hover { text-decoration: underline; }
    .search-container { display: flex; gap: 10px; align-items: center; margin-top: 10px; }
    .search-input { padding: 6px 12px; border: 1px solid #ddd; border-radius: 4px; width: 200px; }
    .search-btn { padding: 6px 15px; background-color: #4285f4; color: white; border: none; border-radius: 4px; cursor: pointer; }
    .imgtable { width: 100%; border-collapse: collapse; margin-top: 10px; }
    .imgtable th, .imgtable td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    .imgtable th { background-color: #f9f9f9; }
    .imgtable tr:hover { background-color: #f1f1f1; }
    .td-desc { max-width: 200px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .pagin { margin-top: 15px; }
    .pagin .message { font-size: 0.9rem; color: #666; margin-bottom: 5px; }
    .paginList { list-style: none; display: flex; gap: 5px; padding: 0; }
    .paginItem a { display: inline-block; padding: 4px 8px; border: 1px solid #ccc; border-radius: 4px; text-decoration: none; color: #333; }
    .paginItem a:hover { background-color: #f0f0f0; }
    .paginItem .active a { background-color: #4285f4; color: white; border-color: #4285f4; }
    .paginItem.disabled a { color: #aaa; pointer-events: none; border-color: #eee; }
    .blue { color: #4285f4; }
  </style>

  <!-- 动态 POST 提交脚本（无 CSRF） -->
  <script th:inline="javascript">
    /*<![CDATA[*/
    function confirmDelete(jobId) {
      if (!confirm('确定要删除 ID=' + jobId + ' 的职位吗？')) {
        return;
      }
      // 创建并提交隐藏表单
      var form = document.createElement('form');
      form.method = 'post';
      form.action = /*[[@{/job/delete}]]*/ '/job/delete';

      var input = document.createElement('input');
      input.type = 'hidden';
      input.name = 'jobId';
      input.value = jobId;
      form.appendChild(input);

      document.body.appendChild(form);
      form.submit();
    }
    /*]]>*/
  </script>
</head>

<body class="bg-f0f9fd font-sans">
<!-- 位置导航 -->
<div class="place">
  <span>位置：</span>
  <ul class="placeul">
    <li><a th:href="@{/}">首页</a></li>
    <li>职位列表</li>
  </ul>
</div>

<div class="rightinfo">
  <!-- 工具栏 -->
  <div class="tools">
    <ul class="toolbar">
      <li class="click">
        <span><img th:src="@{/images/t01.png}" alt="添加" /></span>
        <a th:href="@{/job/add}">添加</a>
      </li>
    </ul>
  </div>

  <!-- 搜索/过滤表单 -->
  <form th:action="@{/job/list}" method="get" class="search-container">
    <input class="search-input" type="text" name="jobNameFilter"
           th:value="${jobNameFilter}" placeholder="职位名称" />
    <input class="search-input" type="number" name="companyIdFilter"
           th:value="${companyIdFilter}" placeholder="公司ID" />
    <button type="submit" class="search-btn">搜索</button>
    <a th:href="@{/job/list}" class="search-btn" style="background:#6c757d;">重置</a>
  </form>

  <!-- 职位表格 -->
  <table class="imgtable">
    <thead>
    <tr>
      <th><input type="checkbox" onclick="toggleAll(this)" /></th>
      <th>职位ID</th><th>名称</th><th>公司ID</th><th>公司名称</th>
      <th>人数</th><th>薪资</th><th>地区</th><th>描述</th>
      <th>结束时间</th><th>状态</th><th>操作</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="job : ${page.records}" height="50px">
      <td><input type="checkbox" name="jobIds" th:value="${job.jobId}" /></td>
      <td th:text="${job.jobId}">ID</td>
      <td th:text="${job.jobName}">名称</td>
      <td th:text="${job.companyId}">CID</td>
      <td th:text="${job.companyName} ?: '—'">公司</td>
      <td th:text="${job.jobHiringnum}">人数</td>
      <td th:text="${job.jobSalary}">薪资</td>
      <td th:text="${job.jobArea}">地区</td>
      <td class="td-desc" th:attr="title=${job.jobDesc}" th:text="${job.jobDesc}">描述</td>
      <td th:text="${job.jobEndtime != null} ? ${#dates.format(job.jobEndtime, 'yyyy-MM-dd')} : '—'">结束</td>
      <td th:text="${job.jobState == 1} ? '启用' : '禁用'">状态</td>
      <td>
        <a th:href="@{/job/edit(jobId=${job.jobId})}" class="tablelink">修改</a>
        &nbsp;|&nbsp;
        <a href="javascript:void(0);" class="tablelink"
           th:onclick="'confirmDelete(' + ${job.jobId} + ');'">
          删除
        </a>
      </td>
    </tr>
    <tr th:if="${#lists.isEmpty(page.records)}">
      <td colspan="12" style="text-align:center;color:#999;">暂无职位</td>
    </tr>
    </tbody>
  </table>

  <!-- 分页 -->
  <div class="pagin">
    <div class="message">
      共 <i class="blue" th:text="${page.pages}">0</i> 页，
      当前第 <i class="blue" th:text="${page.current}">1</i> 页，
      总 <i class="blue" th:text="${page.total}">0</i> 条
    </div>
    <ul class="paginList">
      <li class="paginItem" th:classappend="${page.current == 1} ? 'disabled'">
        <a th:href="@{/job/list(page=1,size=${page.size},jobNameFilter=${jobNameFilter},companyIdFilter=${companyIdFilter})}">首页</a>
      </li>
      <li class="paginItem" th:if="${page.hasPrevious()}">
        <a th:href="@{/job/list(page=${page.current-1},size=${page.size},jobNameFilter=${jobNameFilter},companyIdFilter=${companyIdFilter})}">
          上一页
        </a>
      </li>
      <li class="paginItem active">
        <a href="javascript:void(0)" th:text="${page.current}">1</a>
      </li>
      <li class="paginItem" th:if="${page.hasNext()}">
        <a th:href="@{/job/list(page=${page.current+1},size=${page.size},jobNameFilter=${jobNameFilter},companyIdFilter=${companyIdFilter})}">
          下一页
        </a>
      </li>
      <li class="paginItem" th:classappend="${page.current == page.pages} ? 'disabled'">
        <a th:href="@{/job/list(page=${page.pages},size=${page.size},jobNameFilter=${jobNameFilter},companyIdFilter=${companyIdFilter})}">
          尾页
        </a>
      </li>
    </ul>
  </div>
</div>

<script>
  // 全选/反选
  function toggleAll(src) {
    document.getElementsByName('jobIds').forEach(cb => cb.checked = src.checked);
  }
</script>
</body>
</html>
